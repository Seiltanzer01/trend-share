<!-- templates/predictions_chart.html -->

{% extends "base.html" %}

{% block content %}
<h1>Диаграммы Предсказаний</h1>

{% if charts %}
    {% for instrument, image in charts.items() %}
        <div class="nes-container with-title">
            <p class="title">{{ instrument }}</p>
            <img id="chart-{{ loop.index }}" src="data:image/png;base64,{{ image }}" alt="Диаграмма предсказаний для {{ instrument }}" class="responsive-chart">
        </div>
        <br>
    {% endfor %}
{% else %}
    <p>Нет доступных диаграмм для отображения.</p>
{% endif %}

<!-- Добавляем скрипт для обновления диаграмм -->
<script>
    function fetchCharts() {
        fetch("{{ url_for('fetch_charts') }}")
            .then(response => response.json())
            .then(data => {
                const charts = data.charts;
                for (const [instrument, image] of Object.entries(charts)) {
                    // Находим соответствующий элемент по имени инструмента
                    const chartElement = document.querySelector(`img[alt="Диаграмма предсказаний для ${instrument.split(' (')[0]}"]`);
                    if (chartElement) {
                        chartElement.src = `data:image/png;base64,${image}`;
                    }
                }
            })
            .catch(error => console.error('Error fetching charts:', error));
    }

    // Обновляем диаграммы каждые 30 секунд
    setInterval(fetchCharts, 30000);
</script>
{% endblock %}
