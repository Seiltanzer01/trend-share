<!-- templates/subscription.html -->

{% extends "base.html" %}

{% block content %}
<div class="nes-container with-title">
  <p class="title">Стейкинг / Подписка</p>
  
  {% if not user.wallet_address %}
    <p>Сгенерируйте свой уникальный кошелёк для стейкинга:</p>
    <button class="nes-btn is-primary" id="generateWalletBtn">Сгенерировать Кошелёк</button>
  {% else %}
    <p>Ваш кошелёк: <b>{{ user.wallet_address }}</b></p>
    <button class="nes-btn is-success" id="copyWalletBtn"><i class="fas fa-copy"></i> Копировать Адрес</button>
    
    <hr>
    <h3>Ваши Балансы</h3>
    <ul>
      <li>ETH: <span id="ethBalance">Loading...</span></li>
      <li>WETH: <span id="wethBalance">Loading...</span></li>
      <li>UJO: <span id="ujoBalance">Loading...</span></li>
    </ul>
    
    <hr>
    <h3>Обмен WETH на UJO</h3>
    <form id="exchangeForm" class="nes-container is-rounded" style="padding:1em;">
      <label for="exchangeAmount">Количество WETH для обмена:</label>
      <input type="number" id="exchangeAmount" name="exchangeAmount" class="nes-input" step="0.01" min="0" required>
      <button type="submit" class="nes-btn is-primary"><i class="fas fa-exchange-alt"></i> Обменять</button>
    </form>
    
    <hr>
    <h3>Стейкинг</h3>
    <button class="nes-btn is-success" id="stakeButton">Застейкать (25$)</button>
    
    <div style="margin-top:1rem;">
      <h3>Подтвердите стейкинг</h3>
      <form id="confirmStakeForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="nes-field">
          <label for="tx_hash">Хэш транзакции:</label>
          <input type="text" id="tx_hash" name="txHash" class="nes-input" placeholder="0x..." required>
        </div>
        <button type="submit" class="nes-btn is-primary"><i class="fas fa-check"></i> Подтвердить Стейкинг</button>
      </form>
    </div>
    
    <div id="stakingArea" style="margin-top:1rem;"></div>
    
    <button class="nes-btn is-warning" id="claimRewardsBtn" style="display:none;">Claim Rewards</button>
    <button class="nes-btn is-error" id="unstakeBtn" style="display:none;">Unstake</button>
  {% endif %}
</div>

<!-- Модальное окно для изображений -->
<div id="modal" class="modal" style="display:none;">
  <span class="close">&times;</span>
  <img class="modal-content" id="modal-img">
</div>

<!-- Подключение необходимых библиотек -->
<!-- Web3.py не требуется на фронтенде, так как мы переходим на серверную логику -->

<!-- Подключение собственного скрипта -->
<script>
    window.config = {
        CSRF_TOKEN: "{{ csrf_token }}"
    };
</script>
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}
