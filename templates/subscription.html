<!-- templates/subscription.html -->

{% extends "base.html" %}

{% block content %}
<div class="nes-container with-title">
  <p class="title">Стейкинг / Подписка</p>
  
  {% if not user.wallet_address %}
    <p>Сначала подключите кошелёк:</p>
    <button class="nes-btn is-primary" id="connectWalletBtn">Connect Wallet</button>
  {% else %}
    <p>Ваш кошелёк: <b>{{ user.wallet_address }}</b></p>
    <button class="nes-btn is-primary" id="reconnectWalletBtn">Reconnect Wallet</button>
  {% endif %}
  
  <hr>
  <p>Чтобы получить/сохранить премиум, необходимо внести UJO на сумму >= 20$ + 5$ сбор = 25$ (проверка >= 25$).</p>
  <p>Контракт будет проверять: <b>{{ MY_WALLET_ADDRESS }}</b> — адрес, куда вы отправляете.</p>
  
  {% if user.wallet_address %}
    <!-- Кнопка стейкинга -->
    <button class="nes-btn is-success" id="stakeButton">Застейкать (25$)</button>
    
    <!-- Форма для подтверждения стейкинга -->
    <div style="margin-top:1rem;">
      <h3>Подтвердите стейкинг</h3>
      <form id="confirmStakeForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="nes-field">
          <label for="tx_hash">Хэш транзакции:</label>
          <input type="text" id="tx_hash" name="txHash" class="nes-input" placeholder="0x..." required>
        </div>
        <button type="submit" class="nes-btn is-primary"><i class="fas fa-check"></i> Подтвердить Стейкинг</button>
      </form>
    </div>
  {% else %}
    <button class="nes-btn is-success" disabled>Застейкать (25$)</button>
  {% endif %}
  
  <div id="stakingArea" style="margin-top:1rem;"></div>
  
  <button class="nes-btn is-warning" id="claimRewardsBtn" style="display:none;">Claim Rewards</button>
  <button class="nes-btn is-error" id="unstakeBtn" style="display:none;">Unstake</button>
</div>

<!-- Модальное окно для изображений -->
<div id="modal" class="modal" style="display:none;">
  <span class="close">&times;</span>
  <img class="modal-content" id="modal-img">
</div>

<!-- Подключение необходимых библиотек -->
<!-- Thirdweb SDK -->
<script src="https://cdn.jsdelivr.net/npm/@thirdweb-dev/sdk@latest/dist/thirdweb.umd.min.js"></script>

<!-- Web3.js (уберите, если не используете) -->
<!-- <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script> -->

<!-- WalletConnect Provider (уберите, если используете только Thirdweb) -->
<!-- <script src="https://unpkg.com/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script> -->

<!-- Подключение собственного скрипта -->
<script>
    window.config = {
        TOKEN_CONTRACT_ADDRESS: "{{ TOKEN_CONTRACT_ADDRESS }}",
        MY_WALLET_ADDRESS: "{{ MY_WALLET_ADDRESS }}",
        TOKEN_DECIMALS: {{ TOKEN_DECIMALS }},
        TOKEN_PRICE_USD: {{ token_price_usd }},
        WALLET_ADDRESS: "{{ user.wallet_address if user.wallet_address else '' }}",
        TOKEN_AMOUNT_WEI: {{ (25 / token_price_usd * (10 ** TOKEN_DECIMALS))|int }},
        CSRF_TOKEN: "{{ csrf_token }}"
    };
</script>
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
{% endblock %}
